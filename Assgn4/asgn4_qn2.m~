%HyperParams
k = 1;
sparsity = 10;

%Produce f1
U = dctmtx(256);
s = zeros(64*4,1)
idx = randi(64*4,sparsity,1);
s(idx) = 1;
f1 = U * s;
% plot(f1)

%Produce f2
W = k * eye(256);
idx = randi(64*4,sparsity,1);
s(idx) = 1;
f2 = W * s;
% plot(f2)

%Produce noise 
sigma = 0.01 * mean(f1+f2);
noise = normrnd(0,sigma^2,[256,1]);

f = f1+f2+noise;
figure
subplot(2,2,1)
plot(f);

%Reconstruction 
A = [U W];
%initial guess
rec_f0 = A'*f;
rec_f_basis = l1eq_pd(rec_f0, A, [], f, 1e-3);
rec_f_basis1 = rec_f_basis(1:256,:);
rec_f_basis2 = rec_f_basis(257:512,:);

rec_f1 = U * rec_f_basis1;
rec_f2 = W * rec_f_basis2;
subplot(2,2,2)
plot(rec_f1)
subplot(2,2,3)
plot(rec_f2)
subplot(2,2,4)
plot(rec_f1+rec_f2)

%RMSE Cal
rmse1 = 